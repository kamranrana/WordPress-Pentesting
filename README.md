# Project 7 - WordPress Pentesting

Time spent: 17 hours spent in total

> Objective: Find, analyze, recreate, and document **five vulnerabilities** affecting an old version of WordPress

## Pentesting Report

1. **(Required) Cross-Site Scripting Attack When Creating New Post**
  - [X] Summary: This attack is a cross-site scripting attack that allows someone to inject client-side scripts
                 into web pages that are viewed by other WordPress users. This can allow someone to execute 
                 malicious code if another user mistakenly clicks on the page. I found this vunerability [online](https://blog.sucuri.net/2017/09/stored-cross-site-scripting-vulnerability-in-wordpress-4-8-1.html).
    - Vulnerability types: XSS
    - Tested in version: 4.1.21
    - Fixed in version: 4.2.3
  - [X] GIF Walkthrough: [Link to GIF](https://imgur.com/a/w5IM7P3)
  - [X] Steps to recreate: We will try to recreate this cross-site scripting vunerability using a proof-of-concept approach. 
                           First, we have to login to WordPress using any user account, for me I used an admin account on 
                           my local installation. Next, we go to the "Posts" tab on the left and click on "Add New" in order
                           to create a new post. We give our post a title. Next, we switch the text box where our content is
                           written from "Visual" to "Text". Next, we insert our XSS proof-of-concept such as 
                           `<script type='text/javascript'>alert('XSS');</script>` into our text box with our post content. 
                           Next, we click on the "Preview" button on the right where we will preview our post. Our XSS alert 
                           should come up meaning our malicious code was executed. 
  - [X] Affected source code:
    - [Source Code](https://github.com/WordPress/wordpress-develop/blob/master/src/wp-admin/post.php)
2. **(Required) Cross-Site Scripting Attack When Embedding Youtube URL**
  - [X] Summary: This attack is a cross-site scripting attack that allows a commenter on a post to inject client-side
                 scripts into a Youtube link that is embedded in a post comment. This can allow any commented to execute
                 malicious code when they embed a Youtube link inside of a comment on any post on WordPress. 
    - Vulnerability types: XSS
    - Tested in version: 4.1.21
    - Fixed in version: 4.7.3
  - [X] GIF Walkthrough: [Link to GIF](https://imgur.com/a/7NeZ8F5)
  - [X] Steps to recreate: We will try to recreate this cross-site scripting vulnerability on my local WordPress install by 
                           by using a proof-of-concept. In order to recreate this vulnerability we will first find valid 
                           Youtube link that we will be using for the exploit. The Youtube link that I have chosen is
                           https://www.youtube.com/watch?v=Cdvrcqbew08. Next what we will do is navigate to the WordPress
                           homepage which can be found here http://wpdistillery.vm/. There should be a very large text 
                           box for a comment which we will be exploiting. For our Youtube URL,
                           we will insert a XSS script at the end of our Youtube URL, so the URL will be 
                           `https://www.youtube.com/watch?v=Cdvrcqbew08<script type='text/javascript'>alert('XSS');</script>`. 
                           We will comment with this Youtube URL inside of the comment box by clicking on the "Post Comment"
                           button. This should execute our cross-site scripting vulnerability because the Youtube URL input
                           is not being sanatized.
  - [X] Affected source code:
    - [Source Code](https://github.com/WordPress/wordpress-develop/blob/master/src/wp-admin/comment.php)
3. **(Required) Cross-Site Scripting Attack With Media Attachment Description**
  - [X] Summary: This attack is a cross-site scripting attack that allows someone to upload a media file attachment to WordPress
                 through the WordPress Media Library. Once the attacker uploads the media attachment to the Media Library, they
                 are able to edit the "Description" of the media attachment where they insert the malicious code. When the 
                 media attachment is then viewed by other users, it is executed because of the media attachment description
                 not being sanitized properly. 
    - Vulnerability types: XSS
    - Tested in version: 4.1.21
    - Fixed in version: 4.7.3
  - [ ] GIF Walkthrough: 
  - [X] Steps to recreate: The first thing that I did was download a sample audio MP3 file in order to test this vulnerability using
                           https://www.sample-videos.com/download-sample-audio.php. Next, I went to the "Media" tab on the left in
                           WordPress after I logged in. I clicked on the "Add New" button where I then preceded to upload my sample
                           audio file. After my sample audio file was uploaded, I clicked on the audio file on the bottom left. I 
                           then went to the "Description" tab and that is where I wanted to inject my malicious cross-site scripting
                           code. I used `<script type='text/javascript'>onload=alert('XSS');</script>` for my malicious code because
                           when the media file page loaded, I wanted it to execute my cross-site scripting vulnerability. I then
                           refreshed the page, which triggered my cross-site scripting code. 
  - [X] Affected source code:
    - [Source Code](https://github.com/WordPress/wordpress-develop/blob/master/src/wp-admin/upload.php)

## Assets

The main technique that I used in order to complete this assignment was to find WordPress vunerabilities online
and then to recreate them on my local WordPress installation. I consulted the TAs and they thought that this was
a good technique. The main website which I used to discover WordPress vunerabilities was [this website](https://wpvulndb.com/wordpresses) which I then exploited on my local install. 

## Resources

- [WordPress Vunerability List](https://wpvulndb.com/wordpresses/)
- [WordPress Source Browser](https://core.trac.wordpress.org/browser/)
- [WordPress Developer Reference](https://developer.wordpress.org/reference/)

GIFs created with [LiceCap](http://www.cockos.com/licecap/).

## Notes

One of the main challanges that I encountered while doing this assignment was setting up my Vagrant installation on 
my Windows workstation. 

## License

    Copyright [2018] [Kamran Rana]

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
